supportbot.info {
    log {
        output file /var/log/caddy/access.log
        format json
    }

    # Security headers for case pages â€” prevent indexing and referrer leaks
    @case_pages path /case/* /api/case/*
    header @case_pages {
        defer
        X-Robots-Tag "noindex, nofollow"
        Referrer-Policy "no-referrer"
    }

    # API endpoints
    handle /api/* {
        reverse_proxy signal-bot:8000
    }

    # Static files (local disk)
    handle /static/* {
        reverse_proxy signal-bot:8000
    }

    # R2 attachment proxy (images stored in Cloudflare R2)
    handle /r2/* {
        reverse_proxy signal-bot:8000
    }

    # Signal debug endpoints
    handle /signal/* {
        reverse_proxy signal-bot:8000
    }

    # History callbacks
    handle /history/* {
        reverse_proxy signal-bot:8000
    }

    # Debug endpoints (protected server-side by HTTP_DEBUG_ENDPOINTS_ENABLED)
    handle /debug/* {
        reverse_proxy signal-bot:8000
    }

    handle /retrieve {
        reverse_proxy signal-bot:8000
    }

    # Health check
    handle /healthz {
        reverse_proxy signal-bot:8000
    }

    # Frontend
    handle {
        reverse_proxy signal-web:3000
    }
}

www.supportbot.info {
    redir https://supportbot.info{uri}
}
