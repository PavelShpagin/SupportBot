# ============================================================================
# SupportBot Environment Configuration
# ============================================================================
# Copy this file to .env and fill in the values.
# See instructions below for how to obtain each value.

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------
# DB_BACKEND: "mysql" (default, runs in container) or "oracle" (cloud)
#
# MySQL is the default - runs as a container alongside the app.
# No external database setup required! Data persists in a Docker volume.
# ----------------------------------------------------------------------------
DB_BACKEND=mysql

# ----------------------------------------------------------------------------
# MySQL Settings (default - container-based, no setup needed)
# ----------------------------------------------------------------------------
# These work out-of-the-box with docker-compose.
# The MySQL container is created automatically with these credentials.
# Data is persisted in a Docker volume (mysql_data).
# ----------------------------------------------------------------------------
MYSQL_HOST=db
MYSQL_PORT=3306
MYSQL_DATABASE=supportbot
MYSQL_USER=supportbot
MYSQL_PASSWORD=supportbot
MYSQL_ROOT_PASSWORD=rootpassword

# ----------------------------------------------------------------------------
# Oracle Settings (optional - only if DB_BACKEND=oracle)
# ----------------------------------------------------------------------------
# Only needed if you want to use Oracle Autonomous Database instead of MySQL.
# Requires OCI account and wallet setup - see infra/oci/README.md for details.
# ----------------------------------------------------------------------------
# ORACLE_USER=SUPPORTBOT
# ORACLE_PASSWORD=YourSecurePassword123!
# ORACLE_DSN=supportbot_high
# ORACLE_WALLET_DIR=/opt/oracle/wallet
# TNS_ADMIN=/opt/oracle/wallet

# ----------------------------------------------------------------------------
# Google AI / Gemini API
# ----------------------------------------------------------------------------
# How to get GOOGLE_API_KEY:
#   1. Go to https://aistudio.google.com/apikey
#   2. Click "Create API key"
#   3. Select or create a Google Cloud project (any name works)
#   4. Copy the generated API key
#
# Model choices:
#   - Gate models (cheap, fast): gemini-2.5-flash-lite
#   - Quality models (vision, responses): gemini-3-pro-preview
#   - See https://ai.google.dev/gemini-api/docs/models for full list
# ----------------------------------------------------------------------------
GOOGLE_API_KEY=

# Vision model for image extraction (needs vision capability)
MODEL_IMG=gemini-3-pro-preview

# Gate/extraction models (cheap, many calls) - use Flash-Lite for cost efficiency
MODEL_DECISION=gemini-2.5-flash-lite
MODEL_EXTRACT=gemini-3-pro-preview
MODEL_CASE=gemini-3-pro-preview

# Quality models (fewer calls, need better output)
MODEL_RESPOND=gemini-3-pro-preview
MODEL_BLOCKS=gemini-3-pro-preview

# Embedding model (for RAG vectors stored in Oracle)
EMBEDDING_MODEL=text-embedding-004

# ----------------------------------------------------------------------------
# Chroma (Vector Database for RAG) - CURRENT IMPLEMENTATION
# ----------------------------------------------------------------------------
# Current implementation uses Chroma for vector search.
# These defaults work with docker-compose (rag service).
#
# NOTE: Oracle Autonomous AI Database has built-in vector search (AI Vector Search)
# which could replace Chroma entirely. Future versions may migrate to Oracle-only.
# ----------------------------------------------------------------------------
CHROMA_URL=http://rag:8000
CHROMA_COLLECTION=cases

# ----------------------------------------------------------------------------
# Signal Configuration
# ----------------------------------------------------------------------------
# How to get a Signal number:
#   Option A - Use your own phone:
#     1. Use a phone number you control
#     2. You'll receive SMS verification when registering signal-cli
#
#   Option B - Use Twilio (for a dedicated bot number):
#     1. Create Twilio account at https://www.twilio.com
#     2. Buy a phone number (~$1/month)
#     3. Use Twilio's SMS webhook to receive verification code
#
# SIGNAL_BOT_E164 format:
#   - Must be E.164 format: +[country][number]
#   - Examples: +15551234567 (US), +447911123456 (UK), +61412345678 (AU)
#
# BOT_MENTION_STRINGS:
#   - Comma-separated strings that trigger the bot to respond
#   - e.g., "@supportbot,@SupportBot,@bot"
# ----------------------------------------------------------------------------
SIGNAL_BOT_E164=+15551234567
SIGNAL_BOT_STORAGE=/var/lib/signal/bot
SIGNAL_INGEST_STORAGE=/var/lib/signal/ingest
SIGNAL_CLI=signal-cli
BOT_MENTION_STRINGS=@supportbot,@SupportBot
SIGNAL_LISTENER_ENABLED=true

# SIGNAL_LINK_TIMEOUT_SECONDS: How long to wait for QR code scan when linking device
# Default: 600 seconds (10 minutes)
# Minimum: 60 seconds
SIGNAL_LINK_TIMEOUT_SECONDS=600

# ----------------------------------------------------------------------------
# History Bootstrap
# ----------------------------------------------------------------------------
# Used by signal-ingest for the linked-device history sync flow.
# This allows importing existing chat history when adding the bot to a group.
#
# IMPORTANT: USE_SIGNAL_DESKTOP=true enables real 45-day history sync!
# Without it, signal-cli can only receive NEW messages (no history).
#
# How it works:
#   1. Admin requests a bootstrap token via POST /history/token
#   2. Admin scans QR code to link (either signal-cli or Signal Desktop)
#   3. signal-ingest syncs history, mines cases, then unlinks
#
# Signal Desktop mode (recommended):
#   - Runs Signal Desktop headlessly with Xvfb
#   - Actually receives the 45-day history transfer
#   - Requires more RAM (~500MB for Signal Desktop)
#   - Access QR at http://<server>:8001/screenshot during linking
#
# signal-cli mode (legacy):
#   - Lightweight, low resource usage
#   - Does NOT receive historical messages (signal-cli limitation)
#   - Only captures new messages that arrive after linking
# ----------------------------------------------------------------------------
USE_SIGNAL_DESKTOP=true
SIGNAL_DESKTOP_URL=http://signal-desktop:8001
HISTORY_DIR=/var/lib/history
SIGNAL_BOT_URL=http://signal-bot:8000

# HISTORY_QR_TIMEOUT_SECONDS: How long to wait for admin to scan QR code during linking
# Default: 600 seconds (10 minutes) - gives admin plenty of time to scan
# Minimum: 60 seconds
HISTORY_QR_TIMEOUT_SECONDS=600

# HISTORY_MAX_SECONDS: How long to wait for history sync AFTER QR scan
# Default: 300 seconds (5 minutes) - usually enough for history transfer
HISTORY_MAX_SECONDS=300

HISTORY_IDLE_SECONDS=10
HISTORY_CHUNK_MAX_CHARS=12000
HISTORY_CHUNK_OVERLAP_MESSAGES=3

# ----------------------------------------------------------------------------
# Runtime Behavior
# ----------------------------------------------------------------------------
# LOG_LEVEL: DEBUG, INFO, WARNING, ERROR
# CONTEXT_LAST_N: how many recent messages to include as context for LLM
# RETRIEVE_TOP_K: how many similar cases to fetch from vector search
# WORKER_POLL_SECONDS: background job polling interval
# ----------------------------------------------------------------------------
LOG_LEVEL=INFO
CONTEXT_LAST_N=40
RETRIEVE_TOP_K=5
WORKER_POLL_SECONDS=1
HISTORY_TOKEN_TTL_MINUTES=60
ADMIN_SESSION_STALE_MINUTES=30

# ----------------------------------------------------------------------------
# Public URL for case links
# ----------------------------------------------------------------------------
# Used in bot responses to generate case links.
# In production, set to your domain (e.g., https://supportbot.info)
# In development, use http://localhost:3000
# ----------------------------------------------------------------------------
PUBLIC_URL=https://supportbot.info
