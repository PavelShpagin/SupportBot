{
  "post_stream": {
    "posts": [
      {
        "id": 261746,
        "name": "OHPhoenix",
        "username": "outerhavenphoenix",
        "avatar_template": "/user_avatar/community.signalusers.org/outerhavenphoenix/{size}/50873_2.png",
        "created_at": "2025-02-21T16:02:59.998Z",
        "cooked": "<p>First of all, I’m glad that we have at least have the code to store the database encryption key a bit more securely.  However, it still saves a key on my disk. Albeit the key is encrypted when on the actual disk- it’s still a far cry from modern equivalent!</p>\n<p><strong>TLDR</strong></p>\n<blockquote>\n<p>I’m asking/requesting if we could get HSM or SmartCard support to remove essentially flat encryption with DPAPI (which is older than me!). If that’s not possible use the TPM module through certificate use.</p>\n</blockquote>\n<p><strong>Background</strong></p>\n<blockquote>\n<p>Signal uses “<em>safeStorage</em>” to encrypt your decryption key on your disk. That’s a library provided by Electron, calls to Chromium code (“OSCrypt”), then ultimately calls to windows DPAPI. The [DPAPI] encryption key is unique key to your local user account. So that encryption key you use to keep your database encrypted now, is the same encryption key for your Google Chrome master password (just as an example).</p>\n</blockquote>\n<p><strong>Online Decryption Method</strong></p>\n<blockquote>\n<p>An attacker can reverse the string from your key text file on disk. Then, execute a simple PowerShell script under your user context, call to DPAPI, which can decrypt your database decryption key.</p>\n</blockquote>\n<p><strong>Offline Decryption Method</strong></p>\n<blockquote>\n<p>If the key JSON file is extracted and someone wanted to decrypt it. The attacker would need your user SID and password (or the SHA1 hash of it) and have dumped your registry hives. That’s if you are local.<br>\nIf you are on a domain, the domain controller has a “domain” DPAPI master key that can be dumped (it’s technically a backup). Which circumvents the need for that password. They could also just change your password, so it’s a bit redundant there.</p>\n<p>Granted, both local and domain worlds are more complex than that PowerShell script to DPAPI.</p>\n</blockquote>\n<p><strong>Recommendation I: Smart Cards</strong></p>\n<blockquote>\n<p>This could be better handled by using SmartCards, via a virtual SmartCard certificate or stored on an actual piece of Hardware (like a Yubikey). Which should be universally supported on MacOS, Linux, and Windows. This would require a PIN to allow for decryption, relieving our concerns of our static security mechanism (user context security).</p>\n<p>If Signal could key encryption by SmartCard, it would provide a much more modern solution. That way user intervention would be required to decrypt your database decryption key. Instead of access from any of the user’s process to do so.</p>\n</blockquote>\n<p><strong>Recommendation II: TPM Module</strong></p>\n<blockquote>\n<p>These things are a work of art! TPM modules are designed for secure cryptographic key storage, generation, and retrieval. Windows provides the CSP service “Microsoft Platform Crypto Provider” which will store certificates on your TPM and can require a password upon retrieval. So, in no way can an unauthorized actor access your private key unless if they have the password.</p>\n<p>Signal would be able to use these types of certificates, like smartcard certificates as private keys to encrypt your database.</p>\n</blockquote>\n<p><strong>New Start Up Flow</strong></p>\n<blockquote>\n<ol>\n<li>If certificate encryption has been enabled, enrolled. Upon Signal starting, it will query for the certificate.</li>\n<li>Upon query, smart cards (virtually or not) will natively prompt and ask the user for the credentials required. As for TPM module certificate, Signal will need to prompt for the password.</li>\n<li>Private key is provided from cert store query.</li>\n<li>Decrypt the JSON file string value to decrypt SQL database.</li>\n</ol>\n</blockquote>\n<p>Overall, this provides an exportable flow for keys if they user wishes to do so, upon setup. While also addressing the outdated Windows cryptography API (DPAPI).</p>\n<p><strong>Sources</strong><br>\nCommit Adding Database Encryption: <a href=\"https://github.com/signalapp/Signal-Desktop/commit/e449702a3ad4d07a603b1779914810dc77d7efde\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Use electron's safeStorage API · signalapp/Signal-Desktop@e449702 · GitHub</a><br>\nElectron secureSafe: <a href=\"https://github.com/electron/electron/blob/5d120359f6f6adf730455189d099b0a63a0e5cc9/shell/browser/api/electron_api_safe_storage.cc\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">electron/shell/browser/api/electron_api_safe_storage.cc at 5d120359f6f6adf730455189d099b0a63a0e5cc9 · electron/electron · GitHub</a><br>\nChromium OSCrypt Source Code: <a href=\"https://chromium.googlesource.com/chromium/src/+/refs/heads/main/chrome/browser/os_crypt\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">chrome/browser/os_crypt - chromium/src - Git at Google</a><br>\n<a href=\"https://source.chromium.org/chromium/chromium/src/+/main:components/os_crypt/async/common/encryptor.h;drc=29646f92766d515808be74c85bd5b511e032c023;l=87\" rel=\"noopener nofollow ugc\">https://source.chromium.org/chromium/chromium/src/+/main:components/os_crypt/async/common/encryptor.h;drc=29646f92766d515808be74c85bd5b511e032c023;l=87</a><br>\nAbout DPAPI Decryption: <a href=\"https://dimitrisper.xyz/posts/tech/dpapi-blobs/#storage-locations\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Offline Decryption of DPAPI blobs · Dimitris Pergelidis</a><br>\nDPAPI Domain Decryption: <a href=\"https://www.coresecurity.com/core-labs/articles/reading-dpapi-encrypted-keys-mimikatz\" rel=\"noopener nofollow ugc\">https://www.coresecurity.com/core-labs/articles/reading-dpapi-encrypted-keys-mimikatz</a><br>\nTPM Module Certificate (Windows): <a href=\"https://polansky.co/blog/tpm-backed-certificates-windows/\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Creating TPM-Backed Certificates on Windows - Shea Polansky</a></p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 1,
        "updated_at": "2025-02-21T16:27:35.318Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 34,
        "readers_count": 33,
        "score": 71.8,
        "yours": false,
        "topic_id": 67084,
        "topic_slug": "follow-through-on-database-crypto-key",
        "display_username": "OHPhoenix",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://polansky.co/blog/tpm-backed-certificates-windows/",
            "internal": false,
            "reflection": false,
            "title": "Creating TPM-Backed Certificates on Windows - Shea Polansky",
            "clicks": 1
          },
          {
            "url": "https://github.com/signalapp/Signal-Desktop/commit/e449702a3ad4d07a603b1779914810dc77d7efde",
            "internal": false,
            "reflection": false,
            "title": "Use electron's safeStorage API · signalapp/Signal-Desktop@e449702 · GitHub",
            "clicks": 1
          },
          {
            "url": "https://source.chromium.org/chromium/chromium/src/+/main:components/os_crypt/async/common/encryptor.h;drc=29646f92766d515808be74c85bd5b511e032c023;l=87",
            "internal": false,
            "reflection": false,
            "clicks": 0
          },
          {
            "url": "https://github.com/electron/electron/blob/5d120359f6f6adf730455189d099b0a63a0e5cc9/shell/browser/api/electron_api_safe_storage.cc",
            "internal": false,
            "reflection": false,
            "title": "electron/shell/browser/api/electron_api_safe_storage.cc at 5d120359f6f6adf730455189d099b0a63a0e5cc9 · electron/electron · GitHub",
            "clicks": 0
          },
          {
            "url": "https://www.coresecurity.com/core-labs/articles/reading-dpapi-encrypted-keys-mimikatz",
            "internal": false,
            "reflection": false,
            "clicks": 0
          },
          {
            "url": "https://dimitrisper.xyz/posts/tech/dpapi-blobs/#storage-locations",
            "internal": false,
            "reflection": false,
            "title": "Offline Decryption of DPAPI blobs · Dimitris Pergelidis",
            "clicks": 0
          },
          {
            "url": "https://chromium.googlesource.com/chromium/src/+/refs/heads/main/chrome/browser/os_crypt",
            "internal": false,
            "reflection": false,
            "title": "chrome/browser/os_crypt - chromium/src - Git at Google",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 3
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 31855,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/follow-through-on-database-crypto-key/67084/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      }
    ],
    "stream": [
      261746
    ]
  },
  "timeline_lookup": [
    [
      1,
      358
    ]
  ],
  "suggested_topics": [
    {
      "fancy_title": "Local API for “Note to Self” in Signal Desktop for Secure Clipboard Integration",
      "id": 71266,
      "title": "Local API for “Note to Self” in Signal Desktop for Secure Clipboard Integration",
      "slug": "local-api-for-note-to-self-in-signal-desktop-for-secure-clipboard-integration",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2025-08-27T17:03:56.365Z",
      "last_posted_at": "2025-08-27T17:52:18.535Z",
      "bumped": true,
      "bumped_at": "2025-08-27T17:52:18.535Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags_descriptions": {},
      "like_count": 0,
      "views": 70,
      "category_id": 20,
      "featured_link": null,
      "op_like_count": 0,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 24553,
            "username": "lukejmorrison",
            "name": "Luke",
            "avatar_template": "/user_avatar/community.signalusers.org/lukejmorrison/{size}/40445_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 18285,
            "username": "rassilon1963",
            "name": "Talya (she/her)",
            "avatar_template": "/user_avatar/community.signalusers.org/rassilon1963/{size}/31625_2.png",
            "primary_group_name": "top_contributors",
            "flair_name": "top_contributors",
            "flair_url": "compass",
            "flair_bg_color": "6058CA",
            "flair_color": "fff",
            "flair_group_id": 48,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Automatic Download zip/rar files option.",
      "id": 71187,
      "title": "Automatic Download zip/rar files option.",
      "slug": "automatic-download-zip-rar-files-option",
      "posts_count": 3,
      "reply_count": 0,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2025-08-23T03:30:23.595Z",
      "last_posted_at": "2025-10-01T10:13:41.466Z",
      "bumped": true,
      "bumped_at": "2025-10-01T10:13:41.466Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags_descriptions": {},
      "like_count": 0,
      "views": 77,
      "category_id": 20,
      "featured_link": null,
      "op_like_count": 0,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 33878,
            "username": "whatohyou01",
            "name": "whatohyou01",
            "avatar_template": "/user_avatar/community.signalusers.org/whatohyou01/{size}/53361_2.png",
            "trust_level": 0
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 33306,
            "username": "Mher_Hovhannisyan",
            "name": "Mher Hovhannisyan",
            "avatar_template": "/user_avatar/community.signalusers.org/mher_hovhannisyan/{size}/52680_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 31811,
            "username": "desert_nip",
            "name": "",
            "avatar_template": "/letter_avatar_proxy/v4/letter/d/ccd318/{size}.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Add option to always show the Send button in message input area",
      "id": 70553,
      "title": "Add option to always show the Send button in message input area",
      "slug": "add-option-to-always-show-the-send-button-in-message-input-area",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2025-07-21T00:30:37.334Z",
      "last_posted_at": "2025-07-26T00:29:13.255Z",
      "bumped": true,
      "bumped_at": "2025-07-26T00:29:13.255Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags_descriptions": {},
      "like_count": 5,
      "views": 115,
      "category_id": 20,
      "featured_link": null,
      "op_like_count": 4,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 33580,
            "username": "akashiseizaburou",
            "name": "Akashiseizaburou",
            "avatar_template": "/user_avatar/community.signalusers.org/akashiseizaburou/{size}/53022_2.png",
            "trust_level": 0
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 33610,
            "username": "Ammar_Ahmed",
            "name": "Ammar Ahmed",
            "avatar_template": "/user_avatar/community.signalusers.org/ammar_ahmed/{size}/53064_2.png",
            "trust_level": 0
          }
        }
      ]
    }
  ],
  "tags_descriptions": {},
  "fancy_title": "Follow Through on Database Crypto Key",
  "id": 67084,
  "title": "Follow Through on Database Crypto Key",
  "posts_count": 1,
  "created_at": "2025-02-21T16:02:59.951Z",
  "views": 91,
  "reply_count": 0,
  "like_count": 3,
  "last_posted_at": "2025-02-21T16:02:59.998Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "follow-through-on-database-crypto-key",
  "category_id": 20,
  "word_count": 679,
  "deleted_at": null,
  "user_id": 31855,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_67084",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 1,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 1,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 31855,
        "username": "outerhavenphoenix",
        "name": "OHPhoenix",
        "avatar_template": "/user_avatar/community.signalusers.org/outerhavenphoenix/{size}/50873_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 0
      }
    ],
    "created_by": {
      "id": 31855,
      "username": "outerhavenphoenix",
      "name": "OHPhoenix",
      "avatar_template": "/user_avatar/community.signalusers.org/outerhavenphoenix/{size}/50873_2.png"
    },
    "last_poster": {
      "id": 31855,
      "username": "outerhavenphoenix",
      "name": "OHPhoenix",
      "avatar_template": "/user_avatar/community.signalusers.org/outerhavenphoenix/{size}/50873_2.png"
    },
    "links": [
      {
        "url": "https://github.com/signalapp/Signal-Desktop/commit/e449702a3ad4d07a603b1779914810dc77d7efde",
        "title": "Use electron's safeStorage API · signalapp/Signal-Desktop@e449702 · GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 31855,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://polansky.co/blog/tpm-backed-certificates-windows/",
        "title": "Creating TPM-Backed Certificates on Windows - Shea Polansky",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 31855,
        "domain": "polansky.co",
        "root_domain": "polansky.co"
      }
    ]
  },
  "bookmarks": []
}