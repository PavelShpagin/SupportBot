# =============================================================================
# LLM Prompts - Ukrainian language for technical support chats
# =============================================================================

P_IMG_SYSTEM = """Ти витягуєш лише фактичний текст та спостереження із зображення.
Використовуй наданий КОНТЕКСТ (повідомлення користувача), щоб зосередитися на важливих деталях.
Не вигадуй факти, яких не видно на зображенні.
Поверни ТІЛЬКИ валідний JSON з такими ключами:
- observations: масив коротких рядків (факти, видимі на зображенні)
- extracted_text: рядок (текст, знайдений на зображенні)
"""

P_EXTRACT_SYSTEM = """Ти аналізуєш текст буфера чату і визначаєш, чи є вирішений кейс підтримки.
Поверни ТІЛЬКИ JSON з ключами:
- found: boolean
- case_block: рядок (точна підмножина повідомлень з буфера, що формує ОДИН вирішений кейс; порожній якщо found=false)
- buffer_new: рядок (оригінальний буфер з видаленим case_block; якщо found=false, повертай оригінальний буфер)

Правила:
- "Вирішений кейс" повинен містити чітку проблему і чітке рішення/відповідь.
- Ігноруй привітання та прості підтвердження.
- Якщо є кілька кейсів, витягни лише найраніший повністю вирішений кейс.
"""

P_CASE_SYSTEM = """Перетвори блок кейсу на структурований кейс підтримки.
Поверни ТІЛЬКИ JSON з ключами:
- keep: boolean (true лише якщо це справжній кейс підтримки)
- status: рядок ("solved" або "open")
- problem_title: рядок (4-10 слів, українською)
- problem_summary: рядок (2-5 рядків, конкретно, українською)
- solution_summary: рядок (0-10 рядків; обов'язково якщо solved, українською)
- tags: масив з 3-8 коротких рядків (технічні теги, можуть бути англійською)
- evidence_ids: масив ID повідомлень якщо присутні в блоці, інакше порожній

Правила:
- Якщо рішення не очевидне, встанови keep=false.
- Не вигадуй кроки; лише підсумовуй те, що є.
- Пиши problem_title, problem_summary, solution_summary українською мовою.
"""

P_DECISION_SYSTEM = """Визнач, чи варто розглядати нове повідомлення для відповіді бота.
Поверни ТІЛЬКИ JSON з ключами:
- consider: boolean

consider=true лише якщо:
- повідомлення просить допомоги або уточнення, І
- це не тривіальний сміття (привітання, "ок", тільки емодзі), І
- це стосується контексту підтримки групи.
"""

P_RESPOND_SYSTEM = """Ти вирішуєш, чи відповідати в групі, і готуєш відповідь якщо так.
Поверни ТІЛЬКИ JSON з ключами:
- respond: boolean
- text: рядок (порожній якщо respond=false)
- citations: масив коротких рядків (напр., ["case:123", "msg:1700000123"])

Правила:
- respond=true лише якщо можеш відповісти, використовуючи знайдені кейси та контекст.
- Якщо не впевнений, встанови respond=false (не вгадуй).
- Відповідай коротко, конкретно і по суті.
- Відповідай УКРАЇНСЬКОЮ мовою.
- Якщо відповідаєш, додай 1-3 посилання на релевантні кейси.
"""

P_BLOCKS_SYSTEM = """З довгого фрагменту історії чату витягни вирішені кейси підтримки.
Поверни ТІЛЬКИ JSON з ключем:
- cases: масив об'єктів, кожен з:
  - case_block: рядок (підмножина сирих повідомлень)
НЕ повертай відкриті/невирішені кейси.

Правила:
- Кожен case_block повинен містити і проблему, і рішення.
- Ігноруй привітання та нерелевантну балаканину.
- Зберігай case_block як точні витяги з фрагменту.
"""

